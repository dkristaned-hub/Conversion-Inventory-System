<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice - Cooking Oil Inventory System</title>
  <link rel="stylesheet" href="Main.css">
  <link rel="stylesheet" href="Invoice.css">
</head>
<body>

  <!-- Sidebar -->
  <div class="flex h-screen">
    <aside class="sidebar"> 
      <div class="sidebar-header">
        <h2 class="sidebar-title">Conversion Inventory<br>System</h2>
        <div class="sidebar-user-info">
          <div class="sidebar-profile-picture">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSIzNSIgcj0iMjAiIGZpbGw9IiNDNUNBRDUiLz4KICA8cGF0aCBkPSJNMTUgODVjMC0yNSAzNS0yNSAzNS0yNWgxMHM3LjEgMCAxNyA1YzEyLjUgNi4zIDE4IDIwIDE4IDIwSDE1eiIgZmlsbD0iI0M1Q0FENSIvPgo8L3N2Zz4=" alt="Profile Picture">
          </div>
          <p class="sidebar-welcome">Welcome, Guest</p>
          <p class="sidebar-mode">Admin Mode</p>
        </div>
      </div>
      <nav class="sidebar-nav">
        <a href="Main.html" class="nav-item">Dashboard</a>
        <a href="Inventory.html" class="nav-item">Inventory</a>
        <a href="Monitoring.html" class="nav-item">Monitoring</a>
        <a href="Invoice.html" class="nav-item active">Invoice</a>
        <a href="Profile.html" class="nav-item">Profile Settings</a>
        <a href="#" class="nav-item" onclick="confirmLogout()">Log Out</a>
      </nav>
    </aside>    <!-- Main Content -->
    <main class="main-content">
      <h1 class="page-title">Invoice Management</h1>

      <!-- Top Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <p class="stat-label">Total Invoices</p>
          <h2 class="stat-value">15</h2>
        </div>
        <div class="stat-card">
          <p class="stat-label">Pending Payments</p>
          <h2 class="stat-value">₱45,000</h2>
        </div>
        <div class="stat-card">
          <p class="stat-label">Overdue Invoices</p>
          <h2 class="stat-value">3</h2>
        </div>
        <div class="stat-card">
          <p class="stat-label">Total Revenue</p>
          <h2 class="stat-value">₱225,000</h2>
        </div>
      </div>

      <!-- Pending Invoices -->
      <section class="content-section">
        <h2 class="section-title">Pending Invoices</h2>
        <table class="data-table">
          <thead class="table-header">
            <tr>
              <th>Invoice ID</th>
              <th>Date</th>
              <th>Supplier/Customer</th>
              <th>Amount (₱)</th>
              <th>Due Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </section>

      <!-- Sales -->
      <section class="content-section">
        <h2 class="section-title">Sales Invoices</h2>
        <table class="data-table" id="sales-table">
          <thead class="table-header">
            <tr>
              <th>Invoice ID</th>
              <th>Date</th>
              <th>Customer</th>
              <th>Amount (₱)</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </section>

      <!-- Delivery -->
      <section class="content-section">
        <h2 class="section-title">Delivery Invoices</h2>
        <table class="data-table" id="delivery-table">
          <thead class="table-header">
            <tr>
              <th>Invoice ID</th>
              <th>Date</th>
              <th>Supplier</th>
              <th>Amount (₱)</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </section>

      <!-- Invoice History -->
      <section class="content-section">
        <h2 class="section-title">Invoices History </h2>
        <table class="data-table">
          <thead class="table-header">
            <tr>
              <th>Invoice ID</th>
              <th>Date</th>
              <th>Supplier/Customer</th>
              <th>Amount (₱)</th>
              <th>Payment Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </section>

      <!-- Invoice Submission -->
      <section class="content-section">
        <h2 class="section-title">Invoice Submission</h2>
        <div class="invoice-form-container">
          <form class="invoice-form" id="invoiceForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Invoice ID</label>
                <input type="text" class="form-input" id="invoiceId" placeholder="e.g., INV-2025103" required>
              </div>
              <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" class="form-input" id="invoiceDate" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Supplier/Customer</label>
                <input type="text" class="form-input" id="supplier" placeholder="Enter supplier or customer name" required>
              </div>
              <div class="form-group">
                <label class="form-label">Amount (₱)</label>
                <input type="number" class="form-input" id="amount" placeholder="0.00" step="0.01" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Due Date</label>
                <input type="date" class="form-input" id="dueDate" required>
              </div>
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-input" id="status" required>
                  <option value="Pending">Pending</option>
                  <option value="Paid">Paid</option>
                  <option value="Overdue">Overdue</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Invoice Type</label>
                <select class="form-input" id="invoiceType" required>
                  <option value="Delivery">Delivery</option>
                  <option value="Sale">Sale</option>
                </select>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="primary-button">Submit Invoice</button>
              <button type="button" class="secondary-button" onclick="clearForm()">Clear</button>
            </div>
          </form>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Function to update profile picture
    function updateProfilePicture(imageUrl) {
        const profileImage = document.querySelector('.sidebar-profile-picture img');
        if (profileImage) {
            profileImage.src = imageUrl;
        }
    }

    // Function to confirm logout
    function confirmLogout() {
        if (confirm('Are you sure you want to log out?')) {
            window.location.href = 'Login.html';
        }
    }

    // Function to submit invoice
    function submitInvoice(event) {
        event.preventDefault();

        const invoiceId = document.getElementById('invoiceId').value;
        const date = document.getElementById('invoiceDate').value;
        const supplier = document.getElementById('supplier').value;
        const amount = parseFloat(document.getElementById('amount').value);
        const dueDate = document.getElementById('dueDate').value;
        const status = document.getElementById('status').value;
        const invoiceType = document.getElementById('invoiceType').value;

        if (!invoiceId || !date || !supplier || isNaN(amount) || amount <= 0 || !dueDate || !status || !invoiceType) {
            alert('Please fill in all required fields with valid values.');
            return;
        }

        const invoice = {
            invoiceId,
            date,
            supplier,
            amount,
            dueDate,
            status,
            invoiceType,
            paymentDate: status === 'Paid' ? new Date().toISOString().split('T')[0] : null,
            handler: localStorage.getItem('userName') || 'Guest'
        };

        // Get existing invoices
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        invoices.push(invoice);
        localStorage.setItem('invoices', JSON.stringify(invoices));

        alert('Invoice submitted successfully!');

        // Clear form
        clearForm();

        // Update tables and stats
        updatePendingInvoices();
        updateInvoiceHistory();
        updateInvoiceStats();
        updateSalesTable();
        updateDeliveryTable();
    }

    // Function to clear form
    function clearForm() {
        document.getElementById('invoiceId').value = '';
        document.getElementById('invoiceDate').value = '';
        document.getElementById('supplier').value = '';
        document.getElementById('amount').value = '';
        document.getElementById('dueDate').value = '';
        document.getElementById('status').value = 'Pending';
        document.getElementById('invoiceType').value = 'Delivery';
    }

    // Function to update Pending Invoices table
    function updatePendingInvoices() {
        const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        const tbody = document.querySelector('.content-section:nth-of-type(1) tbody');
        tbody.innerHTML = '';

        const pendingInvoices = invoices.filter(inv => inv.status === 'Pending' || inv.status === 'Overdue');

        if (pendingInvoices.length === 0) {
            tbody.innerHTML = `
                <tr class="table-row">
                  <td class="table-cell" colspan="6">No pending invoices</td>
                </tr>
            `;
            return;
        }

        pendingInvoices.forEach(invoice => {
            const row = document.createElement('tr');
            row.className = 'table-row';
            row.innerHTML = `
                <td class="table-cell">${invoice.invoiceId}</td>
                <td class="table-cell">${invoice.date}</td>
                <td class="table-cell">${invoice.supplier}</td>
                <td class="table-cell">${invoice.amount.toFixed(2)}</td>
                <td class="table-cell">${invoice.dueDate}</td>
                <td class="table-cell">${invoice.status}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Function to update Invoice History table
    function updateInvoiceHistory() {
        const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        const tbody = document.querySelector('.content-section:nth-of-type(4) tbody');
        tbody.innerHTML = '';

        // Sort invoices by date descending (most recent first)
        const sortedInvoices = invoices.sort((a, b) => new Date(b.date) - new Date(a.date));

        if (sortedInvoices.length === 0) {
            tbody.innerHTML = `
                <tr class="table-row">
                  <td class="table-cell" colspan="6">No invoices</td>
                </tr>
            `;
            return;
        }

        sortedInvoices.forEach(invoice => {
            const row = document.createElement('tr');
            row.className = 'table-row';
            row.innerHTML = `
                <td class="table-cell">${invoice.invoiceId}</td>
                <td class="table-cell">${invoice.date}</td>
                <td class="table-cell">${invoice.supplier}</td>
                <td class="table-cell">${invoice.amount.toFixed(2)}</td>
                <td class="table-cell">${invoice.paymentDate || 'N/A'}</td>
                <td class="table-cell">${invoice.status}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Function to update invoice stats
    function updateInvoiceStats() {
        const invoices = JSON.parse(localStorage.getItem('invoices')) || [];

        const totalInvoices = invoices.length;
        const pendingPayments = invoices.filter(inv => inv.status === 'Pending').reduce((sum, inv) => sum + inv.amount, 0);
        const overdueInvoices = invoices.filter(inv => inv.status === 'Overdue').length;
        const totalRevenue = invoices.filter(inv => inv.status === 'Paid').reduce((sum, inv) => sum + inv.amount, 0);

        document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = totalInvoices;
        document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = `₱${pendingPayments.toFixed(2)}`;
        document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = overdueInvoices;
        document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = `₱${totalRevenue.toFixed(2)}`;
    }

    // Function to update Sales table
    function updateSalesTable() {
        const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        const tbody = document.querySelector('#sales-table tbody');
        tbody.innerHTML = '';

        const salesInvoices = invoices.filter(inv => inv.invoiceType === 'Sale');

        if (salesInvoices.length === 0) {
            tbody.innerHTML = `
                <tr class="table-row">
                  <td class="table-cell" colspan="5">No sales invoices</td>
                </tr>
            `;
            return;
        }

        salesInvoices.forEach(invoice => {
            const row = document.createElement('tr');
            row.className = 'table-row';
            row.innerHTML = `
                <td class="table-cell">${invoice.invoiceId}</td>
                <td class="table-cell">${invoice.date}</td>
                <td class="table-cell">${invoice.supplier}</td>
                <td class="table-cell">${invoice.amount.toFixed(2)}</td>
                <td class="table-cell">${invoice.status}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Function to update Delivery table
    function updateDeliveryTable() {
        const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        const tbody = document.querySelector('#delivery-table tbody');
        tbody.innerHTML = '';

        const deliveryInvoices = invoices.filter(inv => inv.invoiceType === 'Delivery');

        if (deliveryInvoices.length === 0) {
            tbody.innerHTML = `
                <tr class="table-row">
                  <td class="table-cell" colspan="5">No delivery invoices</td>
                </tr>
            `;
            return;
        }

        deliveryInvoices.forEach(invoice => {
            const row = document.createElement('tr');
            row.className = 'table-row';
            row.innerHTML = `
                <td class="table-cell">${invoice.invoiceId}</td>
                <td class="table-cell">${invoice.date}</td>
                <td class="table-cell">${invoice.supplier}</td>
                <td class="table-cell">${invoice.amount.toFixed(2)}</td>
                <td class="table-cell">${invoice.status}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Load saved data on page load
    window.addEventListener('load', function() {
        // Load profile picture
        const savedProfilePic = localStorage.getItem('profilePicture');
        if (savedProfilePic) {
            updateProfilePicture(savedProfilePic);
        }

        // Load user name
        const savedName = localStorage.getItem('userName');
        if (savedName) {
            const welcomeText = document.querySelector('.sidebar-welcome');
            if (welcomeText) {
                welcomeText.textContent = `Welcome, ${savedName}`;
            }
        }

        // Load privilege level
        const savedPrivilege = localStorage.getItem('userPrivilege');
        if (savedPrivilege) {
            const modeText = document.querySelector('.sidebar-mode');
            if (modeText) {
                modeText.textContent = `${savedPrivilege} Mode`;
            }
        }

        // Initialize localStorage with static data if empty or no invoices
        const existingInvoices = JSON.parse(localStorage.getItem('invoices')) || [];
        if (existingInvoices.length === 0) {
            const initialInvoices = [
                { invoiceId: 'INV-2025101', date: '2025-10-01', supplier: 'ABC Suppliers', amount: 15000, dueDate: '2025-10-15', status: 'Pending', invoiceType: 'Delivery', paymentDate: null, handler: 'Guest' },
                { invoiceId: 'INV-2025102', date: '2025-10-05', supplier: 'XYZ Distributors', amount: 30000, dueDate: '2025-10-20', status: 'Overdue', invoiceType: 'Delivery', paymentDate: null, handler: 'Guest' },
                { invoiceId: 'INV-2025091', date: '2025-09-15', supplier: 'DEF Oils Ltd.', amount: 50000, dueDate: '2025-09-20', status: 'Paid', invoiceType: 'Sale', paymentDate: '2025-09-20', handler: 'Guest' },
                { invoiceId: 'INV-2025092', date: '2025-09-10', supplier: 'GHI Traders', amount: 40000, dueDate: '2025-09-18', status: 'Paid', invoiceType: 'Sale', paymentDate: '2025-09-18', handler: 'Guest' },
                { invoiceId: 'INV-2025093', date: '2025-09-05', supplier: 'JKL Suppliers', amount: 25000, dueDate: '2025-09-12', status: 'Paid', invoiceType: 'Delivery', paymentDate: '2025-09-12', handler: 'Guest' }
            ];
            localStorage.setItem('invoices', JSON.stringify(initialInvoices));
        }

        // Add form submit event listener
        document.getElementById('invoiceForm').addEventListener('submit', submitInvoice);

        // Update tables and stats
        updatePendingInvoices();
        updateInvoiceHistory();
        updateInvoiceStats();
        updateSalesTable();
        updateDeliveryTable();
    });
  </script>
</body>
</html>
